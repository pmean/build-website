---
title: "Pages written in xxxx template"
source: new
date: "2023-01-10"
categories:
- Blog post
tags:
- Website details
output: html_document
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo=FALSE)
suppressMessages(suppressWarnings(library(glue)))
suppressMessages(suppressWarnings(library(magrittr)))
suppressMessages(suppressWarnings(library(readr)))
suppressMessages(suppressWarnings(library(stringr)))
```

```{r}

check_source <- function(file_text) {
  file_text %>%
    str_subset("^source\\: ") %>%
    str_remove(fixed("source: ")) %>%
    str_remove_all('"')  %>%
    str_remove_all("'") -> file_source
  
  if (length(file_source)==0) return(
    glue("{fn} has no source\n"))

  if (length(file_source)>1) return(
    glue("{fn} has multiple sources\n")) 

  if (file_source!="new") return(
    glue("{fn} has source={file_source}\n"))
  return(NULL)
}

check_dates <- function(file_text) {
  file_text %>%
    str_subset(fixed("date: ")) %>%
    str_remove(fixed("date: ")) %>%
    str_remove_all('"') %>%
    str_remove_all("'")  -> file_date
    if (length(file_date)==0) file_date <-"No date"
    return(file_date)
}

list_pages <- function(page_year) {
  # get yr_list
  yr <- 2023:1999
  glue("[{yr}](http://new.pmean.com/{yr}/)") %>%
    paste(collapse=" | ") -> yr_list
  
  # open files and find information
  problem_files <- NULL
  date_list <- NULL
  for (fn in f) {
    file_text <- read_lines(glue("../text/21/{fn}"))
    problem_files <- append(
      problem_files,
      check_source(file_text))
    date_list <- append(
      date_list,
      check_dates(file_text))
  }
  f %>%
    str_replace(fixed(".Rmd"), "") %>%
    str_replace(fixed(".md"), "") -> f
  n <- length(f)
  o <- order(date_list, f)
  header <- glue("New website ({n} files)")
  glue(
    "+ {date_list[o]} ",
    "[{f[o]}]",
    "(http://new.pmean.com/{f[o]}/)  ") %>%
    paste(collapse="  \n") -> file_list
  return(
    paste0(
      yr_list,
      header,
      file_list, 
      problem_files))
}
```

```{r}

```

`r yr_list`

`r header`

`r file_list`

```{r}
if (length(problem_files)==0) {
  problem_files <- "All files passed date and source quality checks"
}
```

`r paste(problem_files, collapse="\n")`
